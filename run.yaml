---
  - hosts: all
    roles:
      - role: ironicbadger.ansible_role_bash_aliases
    tasks:
      - name: remove ubuntu motd spam
        become: true
        file:
          path: "/etc/update-motd.d/{{ item }}"
          state: absent
        loop:
          - 80-livepatch
          - 95-hwe-eol
          - 10-help-text
        when: ansible_distribution == 'Ubuntu'

# soulpve - Proxmox host
  - hosts: pve
    vars_files:
      - 'vars/vault.yaml'
    pre_tasks:
      - name: Remove enterprise repo
        file:
          state: absent
          path: /etc/apt/sources.list.d/pve-enterprise.list
      - name: Switch to community repo
        apt_repository:
          repo: 'deb http://download.proxmox.com/debian/pve buster pve-no-subscription'
          state: present
      - name: Apt update
        apt:
          upgrade: 'yes'
          update_cache: yes
          cache_valid_time: 3600
    roles:
      - role: ironicbadger.ansible_role_proxmox_nag_removal
      - role: grog.package
      - role: geerlingguy.nfs
      - role: geerlingguy.docker
      - role: ironicbadger.ansible_role_hddtemp
      - role: rossmcdonald.telegraf
      - role: soulpve
      - role: soulfigurine
      - role: ironicbadger.ansible_role_docker_compose_generator
        tags: compose
      - role: ironicbadger.ansible_role_snapraid
    tasks:
      - hostname:
          name: "{{ pve_hostname }}"

# soulbastion
  - hosts: bastion
    vars_files:
      - 'vars/vault.yaml'
    roles:
      - role: geerlingguy.security
      - role: geerlingguy.docker
      - role: soulfigurine
      - role: ironicbadger.ansible_role_docker_compose_generator
        tags: compose

# soulstatus - not yet implemented fully
  - hosts: status
    vars_files:
      - 'vars/vault.yaml'
    roles:
      - role: grog.package
      - role: geerlingguy.docker
      - role: geerlingguy.github-users
      - role: geerlingguy.security
      - role: geerlingguy.ntp
      - role: ironicbadger.ansible_role_bash_aliases
      - role: soulfigurine
      - role: ironicbadger.ansible_role_docker_compose_generator
        tags: compose
      - role: soultraefik
        tags: compose
    tasks:
      - hostname:
          name: "{{ status_hostname }}"
